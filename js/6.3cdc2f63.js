(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"3be4":function(e,a,t){"use strict";t.r(a);var o=function(){var e=this,a=e._self._c;e._self._setupProxy;return a("div",[a("div",{staticClass:"q-pa-md q-gutter-sm"},[a("q-breadcrumbs",[a("q-breadcrumbs-el",{attrs:{label:"Home"}}),a("q-breadcrumbs-el",{attrs:{label:"Cenário"}}),a("q-breadcrumbs-el",{attrs:{label:"Novo"}})],1)],1),a("div",{staticClass:"q-pa-md q-gutter-sm"},[a("q-card",{staticClass:"my-card"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("Cenário")]),a("div",{staticClass:"text-subtitle2"},[e._v(e._s(e.cenarioInput.descricao))])]),a("q-card-section",[a("q-form",{ref:"formAtualizar"},[a("div",{staticClass:"q-pa-md q-gutter-md"},[a("q-input",{attrs:{outlined:"",label:"Descrição do cenario",focus:"",rules:[e=>e&&e.length>0||"Campo de preenchimento obrigatório"]},model:{value:e.cenarioInput.descricao,callback:function(a){e.$set(e.cenarioInput,"descricao",a)},expression:"cenarioInput.descricao"}}),a("q-select",{attrs:{outlined:"",options:e.mapeamentos,label:"Mapeamento",readonly:""},on:{input:e.mapeamentoSelecionado},model:{value:e.mapeamentoId,callback:function(a){e.mapeamentoId=a},expression:"mapeamentoId"}}),a("q-select",{attrs:{outlined:"",options:e.personas,label:"Persona",readonly:""},on:{input:e.pessoaSelecionada},model:{value:e.personaId,callback:function(a){e.personaId=a},expression:"personaId"}}),e.cenarioInput.mapeamentoTemplatePersonaCenarioItens.length>0?a("div",e._l(e.cenarioInput.mapeamentoTemplatePersonaCenarioItens,(function(e){return a("div",{key:e.mapeamentoItem.mapeamentoItemId,staticClass:"text-h6",staticStyle:{"margin-top":"10px"}},[a("cenario-mapeamento-template-persona-component",{attrs:{mapeamentoTemplatePersonaCenario:e}})],1)})),0):e._e()],1)])],1),a("q-separator",{attrs:{dark:""}}),a("q-card-actions",[a("q-btn",{attrs:{color:"primary",icon:"check",label:"Salvar",flat:""},on:{click:function(a){return e.atualizar()}}}),a("q-btn",{attrs:{color:"lingth",icon:"visibility",label:"Compilado",flat:""},on:{click:function(a){return e.visualizarCompilado()}}}),a("q-btn",{attrs:{icon:"arrow_back",label:"Voltar",flat:""},on:{click:function(a){return e.voltar()}}})],1)],1)],1),a("dialog-visualizar-compilado",{ref:"dialogVisualizarCompilado",attrs:{compliado:e.cenarioInput.compilado}})],1)},n=[],i=t("1b40"),r=t("2587"),s=t("0564"),c=t("ec43"),l=t("dc7e"),p=t("934f"),m=t("c647"),d=t("bd4a"),u=function(e,a,t,o){var n,i=arguments.length,r=i<3?a:null===o?o=Object.getOwnPropertyDescriptor(a,t):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(e,a,t,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(i<3?n(r):i>3?n(a,t,r):n(a,t))||r);return i>3&&r&&Object.defineProperty(a,t,r),r},h=function(e,a,t,o){function n(e){return e instanceof t?e:new t((function(a){a(e)}))}return new(t||(t=Promise))((function(t,i){function r(e){try{c(o.next(e))}catch(a){i(a)}}function s(e){try{c(o["throw"](e))}catch(a){i(a)}}function c(e){e.done?t(e.value):n(e.value).then(r,s)}c((o=o.apply(e,a||[])).next())}))};let I=class extends i["c"]{constructor(){super(...arguments),this.cenarioId="",this.mapeamentoId="",this.personaId="",this.mapeamentos=[],this.mapeamentoInput={templateId:"",tipoMapeamentoItem:0,template:{},mapeamentoItens:[]},this.cenarioInput={descricao:"",mapeamentoId:"",templateId:"",templateDescricao:"",personaId:"",persona:{},compilado:{},mapeamentoTemplatePersonaCenarioItens:[]},this.personaSelecionada={},this.personas=[]}visualizarCompilado(){this.$refs.dialogVisualizarCompilado.show(this.cenarioInput.compilado)}atualizar(){this.$refs.formAtualizar.validate().then((e=>{e?this._cenarioService.atualizar(this.cenarioId,this.cenarioInput).then((e=>{console.log(e),this.cenarioInput.compilado=e.data.compilado,this.$q.notify(e.notificacao)})).catch((e=>{this.$q.notify(e.notificacao)})).finally((()=>{this.$q.loading.hide()})):this.$q.notify(s["a"].erro("Favor preencher todos os campos obrigatórios"))}))}recuperaMapeamentos(){this._mapeamentoService.listar().then((e=>{this.mapeamentos=e.map((e=>{var a;return{label:null!==(a=e.template.descricao)&&void 0!==a?a:"",value:e._id,data:e}}))})).catch((e=>{this.$q.notify(e)})).finally((()=>{this.$q.loading.hide()}))}recuperaCenarioPorId(e){return new Promise((a=>{this._cenarioService.recuperaPorId(e).then((e=>{this.cenarioInput=e,this.mapeamentoId=this.mapeamentos.filter((e=>e.value==this.cenarioInput.mapeamentoId))[0],this.personaId=this.personas.filter((e=>e.value==this.cenarioInput.personaId))[0],this.montaValueDoMapeamentoPorPersona()})).catch((e=>{this.$q.notify(e)})).finally((()=>{this.$q.loading.hide(),a("")}))}))}recuperaPersonas(){return new Promise((e=>{this._personaService.listar().then((e=>{this.personas=e.map((e=>{var a,t;let o={};return e.persona["nome"]&&(o={label:null!==(a=e.persona.nome)&&void 0!==a?a:"",value:e._id,data:e.persona}),{label:null!==(t=e.persona.nome)&&void 0!==t?t:"",value:e._id,data:e.persona}}))})).catch((e=>{this.$q.notify(e)})).finally((()=>{this.$q.loading.hide(),e("")}))}))}pessoaSelecionada(e){this.personaSelecionada=e,this.cenarioInput.persona=e.data,this.cenarioInput.personaId=e.value,this.montaValueDoMapeamentoPorPersona()}mapeamentoSelecionado(e){this.cenarioInput.mapeamentoId=e.data._id,this.cenarioInput.templateId=e.data.templateId,this.cenarioInput.templateDescricao=e.data.template.descricao,this.cenarioInput.mapeamentoTemplatePersonaCenarioItens=e.data.mapeamentoItens.map((e=>{let a={mapeamentoTemplatePersonaCenarioItensId:e.mapeamentoItemId,mapeamentoItem:e,value:null};return a})),this.montaValueDoMapeamentoPorPersona()}montaValueDoMapeamentoPorPersona(){var e;this.cenarioInput.persona&&this.cenarioInput.mapeamentoId&&(null===(e=this.cenarioInput.mapeamentoTemplatePersonaCenarioItens)||void 0===e||e.forEach((e=>{void 0==e.value&&e.mapeamentoItem.pathPersona&&(e.value=p["a"].recuperar(this.cenarioInput.persona,e.mapeamentoItem.pathPersona))})))}created(){return h(this,void 0,void 0,(function*(){this._mapeamentoService=new c["a"],this._personaService=new l["a"],this._cenarioService=new r["a"],this.cenarioId=this.$route.params.cenarioId,yield Promise.all([this.recuperaMapeamentos(),this.recuperaPersonas()]),yield this.recuperaCenarioPorId(this.cenarioId)}))}voltar(){this.$router.replace({name:"cenario"})}};I=u([Object(i["a"])({components:{CenarioMapeamentoTemplatePersonaComponent:m["a"],DialogVisualizarCompilado:d["a"]}})],I);var f=I,v=f,b=t("2877"),q=t("ead5"),P=t("079e"),C=t("f09f"),y=t("a370"),g=t("0378"),_=t("27f9"),S=t("ddd8"),w=t("eb85"),$=t("4b7e"),k=t("9c40"),x=t("eebe"),z=t.n(x),Q=Object(b["a"])(v,o,n,!1,null,null,null);a["default"]=Q.exports;z()(Q,"components",{QBreadcrumbs:q["a"],QBreadcrumbsEl:P["a"],QCard:C["a"],QCardSection:y["a"],QForm:g["a"],QInput:_["a"],QSelect:S["a"],QSeparator:w["a"],QCardActions:$["a"],QBtn:k["a"]})}}]);